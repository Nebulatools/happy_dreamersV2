Resumen de generación – Plan 2.1 (transcript_refinement)

- Fecha/hora: 2025-09-22T20:05:56.000Z
- childId: 68d1af5315d0e9b1cc189544
- userId (owner): 68d1a9b07e63c75df18e1c1c
- admin (createdBy): 68d1a9337e63c75df18e1c1b (mariana@admin.com)
- planNumber: 2
- planVersion: "2.1"
- planType: transcript_refinement

Qué se usa exactamente (explícito y escalable)

- Base del plan (schedule): el plan más reciente al momento de refinar → Plan 2 (event_based). Se usa como “plan base a refinar”.
- Fuente del transcript: `workflow/TRANSCRIPTO_MOCK_CONSULTA_2025-09-12.md` (acuerdos finales listados). El sistema extrae cambios de horarios priorizando acuerdos finales sobre recomendaciones intermedias.
- Extracción de cambios: `extractScheduleChangesFromTranscript` (IA), con formato JSON: wakeTime, bedtime, breakfast, lunch, snack, dinner, napTime, napDuration, screenTimeLimit, screenTimeCutoff.
- Prioridad de aplicación: si el transcript especifica un horario/cambio, se aplica por encima del plan base (regla de “prioridad máxima” en el prompt).
- No analiza eventos para 2.1: este tipo no abre nueva ventana de eventos; solo aplica ajustes del transcript al `schedule` del Plan 2 y documenta `transcriptAnalysis`.

Salida (estructura del plan almacenado)

- basedOn: "transcript_analysis"
- basedOnPlan: { planVersion: "2", planId: <id de Plan 2> }
- schedule: actualizado aplicando los acuerdos del transcript (wake 06:50, bedtime 20:35, nap 13:35 x 85–90m, desayuno 08:05, almuerzo 12:40, cena 18:40, pantallas 45m, corte 18:15)
- transcriptAnalysis: { reportId, improvements, adjustments, basePlanVersion: "2" }

Consultas de auditoría (Mongo)

- Ver plan 2.1:
  db.child_plans.find({ planType: 'transcript_refinement', planNumber: 2 }).sort({ createdAt: -1 }).limit(1)
- Ver plan base (Plan 2):
  db.child_plans.find({ planType: 'event_based', planVersion: '2' }).limit(1)
