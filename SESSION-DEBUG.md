# Session Debug Log - Happy Dreamers

*Technical documentation and debugging history*

## ðŸŽ¯ Project Technical Context

### Detected Architecture
- **Framework**: Next.js 15.2.4 with App Router
- **Language**: TypeScript 5.x
- **Database**: MongoDB with Atlas integration
- **Key Dependencies**: 
  - @langchain/core & @langchain/openai (AI integration)
  - next-auth (authentication)
  - bcryptjs (password hashing)
  - recharts (data visualization)
  - shadcn/ui components

### Code Patterns Detected
- **API Structure**: RESTful routes in `/app/api/` with session-based auth
- **Component Architecture**: Feature-based organization in `/components/`
- **State Management**: React Context API (ActiveChildContext)
- **Error Handling**: Try-catch blocks with Spanish user messages

### MongoDB Schema Patterns
```javascript
// Users Collection
{
  _id: ObjectId,
  email: string,
  password: string (hashed),
  name: string,
  role: "parent" | "admin",
  children: ObjectId[] // references to children collection
}

// Children Collection
{
  _id: ObjectId,
  firstName: string,
  lastName: string,
  birthDate: string,
  parentId: string, // user ID
  surveyData: object, // comprehensive survey responses
  createdAt: Date,
  updatedAt: Date
}

// Events Collection
{
  _id: ObjectId,
  childId: string,
  type: "sleep" | "wake" | "nap" | "activity",
  timestamp: Date,
  mood?: string,
  notes?: string,
  duration?: number
}
```

### AI System Architecture
- **LangGraph Multi-Agent System**:
  - Router Agent: Analyzes queries and routes to appropriate agent
  - RAG Agent: Searches specialized pediatric documents
  - Child Data Agent: Analyzes specific child's sleep data
- **Vector Storage**: MongoDB Atlas Search for document embeddings
- **OpenAI Integration**: GPT-4 for consultations and analysis

### Common API Patterns
```typescript
// Standard API route structure
export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions)
    if (!session || !session.user) {
      return NextResponse.json({ error: "No autorizado" }, { status: 401 })
    }
    // Route logic here
  } catch (error) {
    console.error("Error:", error)
    return NextResponse.json({ error: "Error interno del servidor" }, { status: 500 })
  }
}
```

## ðŸ“‹ Session History

### Initial Setup - January 21, 2025
- **System Analysis**: Repository analyzed and workflow initialized
- **Files Created**: SESSION-CONTEXT.md, SESSION-DEBUG.md, tasks/TODO.md
- **Configuration**: Claude auto-configured for Happy Dreamers sleep tracking platform
- **Key Findings**:
  - Spanish-language application for child sleep tracking
  - Multi-tenant architecture with family data isolation
  - Advanced AI integration with RAG system
  - Comprehensive survey system for child assessments

### Environment Setup Notes
- **MongoDB Connection**: Uses singleton pattern to avoid multiple connections
- **Auth Configuration**: NextAuth with MongoDB adapter and JWT strategy
- **API Security**: All routes check session before data access
- **Development Branch**: Currently on 'devpraulio' branch

### Known Technical Considerations
1. **MongoDB URI**: Required in environment variables
2. **OpenAI API Key**: Needed for AI features
3. **NextAuth Secret**: Required for session security
4. **Vercel Deployment**: Project configured for serverless deployment

---
*Auto-generated by Claude AI Workflow System for Happy Dreamers*
