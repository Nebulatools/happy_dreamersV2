# Diagrama de Flujo - Sistema de Planes

## VisualizaciÃ³n del Sistema de Estados y Transiciones

---

## ðŸ“Š Diagrama de Estados Completo

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   ADMIN GENERA   â”‚
                         â”‚      PLAN        â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    BORRADOR      â”‚
                         â”‚                  â”‚
                         â”‚  â€¢ No visible    â”‚
                         â”‚    para usuario  â”‚
                         â”‚  â€¢ Editable      â”‚
                         â”‚  â€¢ Eliminable    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Admin aplica
                                  â”‚ (PATCH)
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        ACTIVO           â”‚
                    â”‚                         â”‚
                    â”‚  â€¢ Visible para usuario â”‚
                    â”‚  â€¢ Plan principal       â”‚
                    â”‚  â€¢ Solo 1 por niÃ±o      â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                         â”‚                â”‚
          Nuevo plan     â”‚                â”‚ Admin elimina
          aplicado       â”‚                â”‚ (DELETE)
                         â”‚                â”‚
                         â–¼                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  COMPLETADO  â”‚   â”‚   ELIMINADO  â”‚
                â”‚              â”‚   â”‚              â”‚
                â”‚ â€¢ Historial  â”‚   â”‚ â€¢ Plan borradoâ”‚
                â”‚ â€¢ No editableâ”‚   â”‚ â€¢ Reactiva elâ”‚
                â”‚ â€¢ Visible    â”‚   â”‚   anterior   â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Plan activo eliminado
                       â”‚ (ReactivaciÃ³n)
                       â”‚
                       â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    ACTIVO    â”‚
                â”‚ (REACTIVADO) â”‚
                â”‚              â”‚
                â”‚ â€¢ Vuelve a   â”‚
                â”‚   ser activo â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Flujo de AplicaciÃ³n de Plan (ProgresiÃ³n)

### Caso: Aplicar Plan 1 cuando Plan 0 estÃ¡ activo

```
ANTES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Planes del NiÃ±o                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Plan 0: ACTIVO          â† Usuario ve    â”‚
â”‚ Plan 1: BORRADOR        â† Admin ve      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”‚
                    â”‚ Admin ejecuta:
                    â”‚ PATCH /api/consultas/plans/[plan1_id]
                    â”‚
                    â–¼

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  LÃ³gica del Backend:     â”‚
         â”‚                          â”‚
         â”‚  1. Marcar Plan 0 como   â”‚
         â”‚     "completado"         â”‚
         â”‚                          â”‚
         â”‚  2. Marcar Plan 1 como   â”‚
         â”‚     "activo"             â”‚
         â”‚                          â”‚
         â”‚  3. Registrar auditorÃ­a  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”‚
                    â–¼

DESPUÃ‰S:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Planes del NiÃ±o                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Plan 0: COMPLETADO      â† Historial     â”‚
â”‚ Plan 1: ACTIVO          â† Usuario ve    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         Usuario ahora ve Plan 1
         Plan 0 en historial
```

---

## ðŸ”„ Flujo de EliminaciÃ³n con ReactivaciÃ³n

### Caso: Eliminar Plan 1 activo (reactivar Plan 0)

```
ANTES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Planes del NiÃ±o                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Plan 0: COMPLETADO                      â”‚
â”‚ Plan 1: ACTIVO          â† Usuario ve    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”‚
                    â”‚ Admin ejecuta:
                    â”‚ DELETE /api/consultas/plans/[plan1_id]
                    â”‚
                    â–¼

      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  LÃ³gica del Backend:            â”‚
      â”‚                                 â”‚
      â”‚  1. Detectar que Plan 1 es      â”‚
      â”‚     ACTIVO                      â”‚
      â”‚                                 â”‚
      â”‚  2. Buscar plan anterior:       â”‚
      â”‚     - Obtener todos los planes  â”‚
      â”‚     - Ordenar por versiÃ³n       â”‚
      â”‚     - Tomar el primero (Plan 0) â”‚
      â”‚                                 â”‚
      â”‚  3. Reactivar Plan 0:           â”‚
      â”‚     - status = "activo"         â”‚
      â”‚     - reactivatedAt = now       â”‚
      â”‚     - reactivatedBy = admin     â”‚
      â”‚     - reactivatedReason = ...   â”‚
      â”‚                                 â”‚
      â”‚  4. Eliminar Plan 1             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”‚
                    â–¼

DESPUÃ‰S:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Planes del NiÃ±o                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Plan 0: ACTIVO (REACTIVADO) â† Usuario veâ”‚
â”‚         reactivatedReason:              â”‚
â”‚         "Plan 1 eliminado"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         Usuario vuelve a ver Plan 0
         Sin pÃ©rdida de progreso
```

---

## ðŸ”„ Flujo con Refinamientos (Versiones N.1)

### Caso Complejo: Plan 0 â†’ 1 â†’ 1.1 â†’ 2

```
Timeline de EvoluciÃ³n:

DÃA 1:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0       â”‚
â”‚ ACTIVO       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DÃA 7:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0       â”‚  â”‚ Plan 1       â”‚
â”‚ COMPLETADO   â”‚  â”‚ ACTIVO       â”‚ â† Usuario ve
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DÃA 10 (Refinamiento con consulta):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0       â”‚  â”‚ Plan 1       â”‚  â”‚ Plan 1.1     â”‚
â”‚ COMPLETADO   â”‚  â”‚ COMPLETADO   â”‚  â”‚ ACTIVO       â”‚ â† Usuario ve
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DÃA 14:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0       â”‚  â”‚ Plan 1       â”‚  â”‚ Plan 1.1     â”‚  â”‚ Plan 2       â”‚
â”‚ COMPLETADO   â”‚  â”‚ COMPLETADO   â”‚  â”‚ COMPLETADO   â”‚  â”‚ ACTIVO       â”‚ â† Usuario ve
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Si se elimina Plan 2:

```
ORDENAMIENTO DE PLANES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Versiones disponibles:             â”‚
â”‚ - 1.1 (refinamiento de 1)          â”‚
â”‚ - 1   (plan base)                  â”‚
â”‚ - 0   (plan inicial)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”‚ compareVersions aplicado
        â”‚
        â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Orden de mayor a menor:            â”‚
â”‚ 1. Plan 1.1 â† Este se reactiva     â”‚
â”‚ 2. Plan 1                          â”‚
â”‚ 3. Plan 0                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”‚
        â–¼

RESULTADO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0       â”‚  â”‚ Plan 1       â”‚  â”‚ Plan 1.1     â”‚
â”‚ COMPLETADO   â”‚  â”‚ COMPLETADO   â”‚  â”‚ ACTIVO       â”‚ â† Usuario ve
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     (REACTIVADO)

Plan 2 eliminado
```

---

## ðŸ“Š Diagrama de Secuencia - Aplicar Plan

```
Admin                API                    MongoDB
  â”‚                   â”‚                        â”‚
  â”‚ PATCH plan/[id]   â”‚                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 1. Verificar sesiÃ³n    â”‚
  â”‚                   â”‚    y permisos          â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 2. Obtener plan        â”‚
  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚   planToApply          â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 3. Verificar status    â”‚
  â”‚                   â”‚    = "borrador"        â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 4. Marcar activos      â”‚
  â”‚                   â”‚    como "completado"   â”‚
  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                   â”‚   updateMany(...)      â”‚
  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚   {modifiedCount: 1}   â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 5. Activar plan        â”‚
  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                   â”‚   updateOne(...)       â”‚
  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚   {modifiedCount: 1}   â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 6. Obtener plan        â”‚
  â”‚                   â”‚    actualizado         â”‚
  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚   updatedPlan          â”‚
  â”‚                   â”‚                        â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
  â”‚  {success, plan}  â”‚                        â”‚
  â”‚                   â”‚                        â”‚
```

---

## ðŸ“Š Diagrama de Secuencia - Eliminar con ReactivaciÃ³n

```
Admin                API                    MongoDB
  â”‚                   â”‚                        â”‚
  â”‚ DELETE plan/[id]  â”‚                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 1. Obtener plan a      â”‚
  â”‚                   â”‚    eliminar            â”‚
  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚   planToDelete         â”‚
  â”‚                   â”‚   (status: "activo")   â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 2. Obtener todos       â”‚
  â”‚                   â”‚    los planes          â”‚
  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚   [plan0, plan1, ...]  â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 3. Ordenar por versiÃ³n â”‚
  â”‚                   â”‚    (compareVersions)   â”‚
  â”‚                   â”‚    [1.1, 1, 0]         â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 4. Reactivar Plan 1.1  â”‚
  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                   â”‚   updateOne(...)       â”‚
  â”‚                   â”‚   status = "activo"    â”‚
  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚   {modifiedCount: 1}   â”‚
  â”‚                   â”‚                        â”‚
  â”‚                   â”‚ 5. Eliminar plan       â”‚
  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                   â”‚   deleteOne(...)       â”‚
  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                   â”‚   {deletedCount: 1}    â”‚
  â”‚                   â”‚                        â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
  â”‚  {success,        â”‚                        â”‚
  â”‚   reactivated}    â”‚                        â”‚
  â”‚                   â”‚                        â”‚
```

---

## ðŸŽ¯ Matriz de Transiciones de Estado

| Estado Inicial | AcciÃ³n              | Estado Final | Trigger              | AutomÃ¡tico |
|----------------|---------------------|--------------|----------------------|------------|
| `borrador`     | Aplicar (PATCH)     | `activo`     | Admin aplica plan    | No         |
| `borrador`     | Eliminar (DELETE)   | Eliminado    | Admin borra borrador | No         |
| `activo`       | Nuevo plan aplicado | `completado` | Admin aplica otro    | âœ… SÃ­      |
| `activo`       | Eliminar (DELETE)   | Eliminado    | Admin borra plan     | No         |
| `completado`   | Plan activo borrado | `activo`     | ReactivaciÃ³n auto    | âœ… SÃ­      |
| `completado`   | Eliminar (DELETE)   | Eliminado    | Admin borra historial| No         |

---

## ðŸ” Ãrbol de DecisiÃ³n - EliminaciÃ³n de Plan

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Plan a eliminar     â”‚
                    â”‚ obtenido            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Â¿Es ACTIVO?         â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚       â”‚
                     NO   â”‚       â”‚   SÃ
                          â”‚       â”‚
                          â”‚       â–¼
                          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    â”‚ Obtener otros planes â”‚
                          â”‚    â”‚ del mismo niÃ±o       â”‚
                          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚               â”‚
                          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    â”‚ Â¿Hay otros planes?   â”‚
                          â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚          â”‚        â”‚
                          â”‚     NO   â”‚        â”‚   SÃ
                          â”‚          â”‚        â”‚
                          â”‚          â”‚        â–¼
                          â”‚          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚          â”‚    â”‚ Ordenar por      â”‚
                          â”‚          â”‚    â”‚ versiÃ³n (mayor   â”‚
                          â”‚          â”‚    â”‚ a menor)         â”‚
                          â”‚          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚          â”‚             â”‚
                          â”‚          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚          â”‚    â”‚ Tomar primer planâ”‚
                          â”‚          â”‚    â”‚ (mÃ¡s reciente)   â”‚
                          â”‚          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚          â”‚             â”‚
                          â”‚          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚          â”‚    â”‚ Reactivar plan:  â”‚
                          â”‚          â”‚    â”‚ - status = activoâ”‚
                          â”‚          â”‚    â”‚ - reactivatedAt  â”‚
                          â”‚          â”‚    â”‚ - reactivatedBy  â”‚
                          â”‚          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚          â”‚             â”‚
                          â–¼          â–¼             â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Eliminar plan original      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Retornar success con info   â”‚
                      â”‚ de reactivaciÃ³n (si aplica) â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“ˆ EvoluciÃ³n de un Plan a travÃ©s del Tiempo

### LÃ­nea de Tiempo Visual

```
Semana 1          Semana 2          Semana 3          Semana 4
   â”‚                 â”‚                 â”‚                 â”‚
   â”‚                 â”‚                 â”‚                 â”‚
   â–¼                 â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚Plan 0â”‚         â”‚Plan 1â”‚         â”‚Plan  â”‚         â”‚Plan 2â”‚
â”‚ACTIVOâ”‚    â†’    â”‚ACTIVOâ”‚    â†’    â”‚ 1.1  â”‚    â†’    â”‚ACTIVOâ”‚
â””â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”˜         â”‚ACTIVOâ”‚         â””â”€â”€â”€â”€â”€â”€â”˜
                                  â””â”€â”€â”€â”€â”€â”€â”˜
   â”‚                 â”‚                 â”‚                 â”‚
   â”‚ Genera          â”‚ Eventos         â”‚ Transcript      â”‚ Eventos
   â”‚ basado en       â”‚ registrados     â”‚ de consulta     â”‚ registrados
   â”‚ cuestionario    â”‚                 â”‚                 â”‚
   â”‚                 â”‚                 â”‚                 â”‚
   â–¼                 â–¼                 â–¼                 â–¼

COMPLETADO      COMPLETADO      COMPLETADO        (En progreso)
```

### Estados Acumulados

```
DespuÃ©s de Semana 1:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0: ACTIVO          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DespuÃ©s de Semana 2:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0: COMPLETADO      â”‚
â”‚ Plan 1: ACTIVO          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DespuÃ©s de Semana 3:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0: COMPLETADO      â”‚
â”‚ Plan 1: COMPLETADO      â”‚
â”‚ Plan 1.1: ACTIVO        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DespuÃ©s de Semana 4:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan 0: COMPLETADO      â”‚
â”‚ Plan 1: COMPLETADO      â”‚
â”‚ Plan 1.1: COMPLETADO    â”‚
â”‚ Plan 2: ACTIVO          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Ciclo de Vida Completo de un Plan

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          CICLO DE VIDA DE UN PLAN          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GENERADO   â”‚  Admin genera plan basado en:
â”‚  (Borrador)  â”‚  - Cuestionario (Plan 0)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  - Eventos (Plan N)
       â”‚          - Transcript (Plan N.1)
       â”‚
       â”‚ Admin revisa y edita si es necesario
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   APLICADO   â”‚  Admin aplica el plan
â”‚   (Activo)   â”‚  - Usuarios ven el plan
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  - Solo 1 activo por niÃ±o
       â”‚          - Planes anteriores â†’ completados
       â”‚
       â”‚ Usuario sigue el plan
       â”‚ Se registran eventos
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REEMPLAZADO â”‚  Nuevo plan es aplicado
â”‚ (Completado) â”‚  - Plan pasa a historial
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  - Visible para referencia
       â”‚          - No editable
       â”‚
       â”‚ Plan activo eliminado
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REACTIVADO   â”‚  Si se elimina plan activo
â”‚  (Activo)    â”‚  - Vuelve a ser activo
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  - Usuario lo ve de nuevo
                  - Sin pÃ©rdida de progreso
```

---

**Fin del documento de diagramas**
